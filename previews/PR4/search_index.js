var documenterSearchIndex = {"docs":
[{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"EditURL = \"https://github.com/tkf/Maybe.jl/blob/master/examples/lift-macro.jl\"","category":"page"},{"location":"tutorials/lift-macro/#tutorial","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"","category":"section"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"using Maybe","category":"page"},{"location":"tutorials/lift-macro/#Introduction","page":"Maybe.jl tutorial","title":"Introduction","text":"","category":"section"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"Julia Base provides functions findfirst and findlast that returns an integer when it's found:","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"findfirst(x -> gcd(x, 42) == 21, 50:200)","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"and nothing if not:","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"@assert findlast(x -> gcd(x, 42) == 23, 50:200) === nothing","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"Using such functions is rather tedious","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"function find_some_random_range_1(data)\n    f(x) = gcd(x, 42) == 21\n    i = findfirst(f, data)\n    i === nothing && return nothing\n    j = findlast(f, data)\n    j === nothing && return nothing\n    return data[i:j]\nend\n\n@assert find_some_random_range_1(50:200) === 63:189\n@assert find_some_random_range_1(30:50) === nothing","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"To solve this issue, Maybe.jl provides a macro @? that lets you write","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"function find_some_random_range_2(data)\n    f(x) = gcd(x, 42) == 21\n    @? begin\n        i = findfirst(f, data)\n        j = findlast(f, data)\n        return data[i:j]\n    end\nend\n\n@assert find_some_random_range_2(50:200) === Some(63:189)\n@assert find_some_random_range_2(30:50) === nothing","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"Similarly, @? is also useful for indexing of arrays, dictionaries, etc. that may fail.  For example","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"dict = Dict(:a => 1, :b => nothing, :c => 2)\n@assert (@? dict[:a] + dict[:c]) == Some(3)\n@assert (@? dict[:a] + dict[:non_existing_key]) === nothing","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"This is explained in more details in Indexing section below.","category":"page"},{"location":"tutorials/lift-macro/#How-it-works","page":"Maybe.jl tutorial","title":"How it works","text":"","category":"section"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"The above example find_some_random_range_2 is roughly equivalent to","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"function find_some_random_range_3(data)\n    f(x) = gcd(x, 42) == 21\n    mi = findfirst(f, data)\n    mi === nothing && return nothing  # (1)\n    i = something(mi)                 # (2)\n    mj = findlast(f, data)\n    mj === nothing && return nothing  # (1)\n    j = something(mj)                 # (2)\n    md = Maybe.getindex(data, i:j)    # (3)\n    md === nothing && return nothing  # (1)\n    d = something(md)                 # (2′)\n    return Some(d)                    # (4)\nend\n\n@assert find_some_random_range_3(50:200) === Some(63:189)\n@assert find_some_random_range_3(30:50) === nothing","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"Observe that:","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"(1) If a function returns a nothing, the whole evaluation short-circuits and evaluates to nothing.  (Side notes: short-circuiting is not actually implemented using return in @? so that it can be used outside functions.)","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"(2) The returned value is always unwrapped by something.  Thus, it works with \"ordinary\" functions like + as well as a function returning Some (like Maybe.getindex); see (2′).","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"(3) Indexing dispatches to Maybe.getindex.","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"(4) Finally, the returned result is always ensured to be wrapped by Some.","category":"page"},{"location":"tutorials/lift-macro/#More-examples","page":"Maybe.jl tutorial","title":"More examples","text":"","category":"section"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"Consider a function that returns nothing on \"failure\":","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"maybe_positive(x) = x > 0 ? x : nothing;\nnothing #hide","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"When a function call in @? is evaluated to a non-nothing, the returned value is wrapped in Some:","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"@? maybe_positive(1)","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"When Some appears in the argument positions, they are automatically un-wrapped:","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"@? maybe_positive(1) + 1","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"@? is evaluated to nothing when the first sub-expression is evaluated to nothing:","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"r = @? maybe_positive(-1) + 1\n@assert r === nothing","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"Literal nothing is transformed to Some(nothing):","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"@? nothing","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"@? terminates the call chain immediately when it sees nothing as the return value.","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"ARG_HISTORY = []\ndemo(label, x) = (push!(ARG_HISTORY, label => x); x)\n\nr = @? demo(2, identity(demo(1, nothing)))\n@assert r === nothing","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"Note that demo(2, ...) is not called:","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"ARG_HISTORY","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"This can be avoided by prefixing the function name by $:","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"empty!(ARG_HISTORY)\n\n@? $demo(2, $identity($demo(1, nothing)))","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"Now demo(2, ...) is called:","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"ARG_HISTORY","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"This is because @? automatically unwraps Some in the call chain. It means that Some acts like the identity function inside @?:","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"@? Some(Some(Some(nothing)))","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"On the other hand, identity acts like \"unwrap\" function:","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"r = @? identity(identity(Some(nothing)))\n@assert r === nothing","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"Finally, with $Some:","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"@? $Some($Some($Some(nothing)))","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"$(expression) can be used to evaluate the whole expression in the normal context","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"@? $(Some(Some(Some(nothing))))","category":"page"},{"location":"tutorials/lift-macro/#tutorials-lift-macro-indexing","page":"Maybe.jl tutorial","title":"Indexing","text":"","category":"section"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"Index access is also lifted.  Consider a dictionary","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"dict = Dict(:a => Dict(:b => nothing, :c => 2));\nnothing #hide","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"Any value stored in the container (here, a Dict) is returned as a Some:","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"@? dict[:a][:c]","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"Thus, nothing stored in the container is returned as Some(nothing)","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"@? dict[:a][:b]","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"On the other hand, accessing non-existing index returns a nothing:","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"@assert (@? dict[:a][:d]) === nothing\n@assert (@? dict[:d]) === nothing","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"Index access can be \"fused\" with other function calls:","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"@assert (@? dict[:a][:c] + 1) === Some(3)\n@assert (@? dict[:a][:d] + 1) === nothing","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"Existing nothing value can be normalized using something as usual inside @?.  This is because @? automatically unwraps Some once.","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"@assert (@? something(dict[:a][:b], 0) + 1) === Some(1)\n@assert (@? something(dict[:a][:c], 0) + 1) === Some(3)\n@assert (@? something(dict[:a][:d], 0) + 1) === nothing","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"Since identity acts like unwrapping operation inside @?, it can be used for normalizing non-existing key and existing nothing to the same value:","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"@assert something((@? identity(dict[:a][:b])), 0) + 1 === 1\n@assert something((@? identity(dict[:a][:c])), 0) + 1 === 3\n@assert something((@? identity(dict[:a][:d])), 0) + 1 === 1","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"Indexing also works with arrays","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"vectors = [[1, 2], [3, 4, 5]]\n\n@assert (@? vectors[1][2]) === Some(2)\n@assert (@? vectors[3][4]) === nothing\n@assert (@? vectors[1][3]) === nothing","category":"page"},{"location":"tutorials/lift-macro/#@?-return","page":"Maybe.jl tutorial","title":"@? return","text":"","category":"section"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"return in @? is a powerful pattern for returning a non-nothing value.","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"function first_something(dict)\n    @? return dict[:a]\n    @? return dict[:b]\n    @? return dict[:c]\n    return nothing\nend\n\n@assert first_something(Dict()) == nothing\n@assert first_something(Dict(:c => 3)) == Some(3)\n@assert first_something(Dict(:a => 1, :c => 3)) == Some(1)","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"Alternatively, combined with @something:","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"function first_something3(dict)\n    return @something {\n        @? dict[:a];\n        @? dict[:b];\n        @? dict[:c];\n        0;  # fallback\n    }\nend\n\n@assert first_something3(Dict()) === 0\n@assert first_something3(Dict(:c => 3)) === 3\n@assert first_something3(Dict(:a => 1, :c => 3)) === 1","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"Note that @? can have multiple statements.  Any of the sub-expression evaluating to nothing short-circuits to the end of @? block.","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"function a_plus_b(dict)\n    @? begin\n        a = dict[:a]\n        b = dict[:b]\n        return a + b\n    end\n    return 0\nend\n\n@assert a_plus_b(Dict(:a => 1)) == 0\n@assert a_plus_b(Dict(:a => 1, :b => 2)) == Some(3)","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"Note that @? works with other control flows like break:","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"function something_positive_add3(xs, idx)\n    found = nothing\n    for i in idx\n        @? if xs[i] > 0  # out-of-bound access is ignored\n            found = i\n            break\n        end\n    end\n    return @? xs[found] + 3\nend\n\n@assert something_positive_add3([-1, 0, 1], [0, 1, 3]) === Some(4)\n@assert something_positive_add3([-1, 0, 1], [0, 1, 2]) === nothing","category":"page"},{"location":"tutorials/lift-macro/#Functions","page":"Maybe.jl tutorial","title":"Functions","text":"","category":"section"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"When @? sees functions (including closures and do blocks ), it converts them recursively to operate on Union{Some{T},Nothing}.","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"@? get_a_plus_b(dict) =\n    get(dict, :a_plus_b) do\n        dict[:a] + dict[:b]\n    end\n\n@assert get_a_plus_b(Dict(:a_plus_b => 1)) == Some(1)\n@assert get_a_plus_b(Dict(:a => 1, :b => 2)) == Some(3)\n@assert get_a_plus_b(Dict(:b => 1)) == nothing","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"Thus, functions created with @? work nicely in @?:","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"@? begin\n    x = get_a_plus_b(Dict(:a_plus_b => 1))\n    y = get_a_plus_b(Dict(:a => 1, :b => 2))\n    x + y\nend","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"","category":"page"},{"location":"tutorials/lift-macro/","page":"Maybe.jl tutorial","title":"Maybe.jl tutorial","text":"This page was generated using Literate.jl.","category":"page"},{"location":"#Maybe.jl","page":"Maybe.jl","title":"Maybe.jl","text":"","category":"section"},{"location":"","page":"Maybe.jl","title":"Maybe.jl","text":"note: Note\nTutorial is the best place to start.","category":"page"},{"location":"","page":"Maybe.jl","title":"Maybe.jl","text":"Modules = [Maybe]","category":"page"},{"location":"#Maybe.Maybe","page":"Maybe.jl","title":"Maybe.Maybe","text":"Maybe.jl: Optional value handling for Julia\n\n(Image: Dev) (Image: GitHub Actions)\n\nMaybe.jl provides functions and macros for handling the values of type Union{Some,Nothing} (i.e., optional values) in Julia.  The main entry point for the optional value handling is the macro @?:\n\njulia> using Maybe\n\njulia> data = [1, 3, 2, 1];\n\njulia> @? data[findfirst(iseven, data)]\nSome(2)\n\njulia> y = @? data[findfirst(>=(4), data)]\n\njulia> @assert y === nothing\n\njulia> Maybe.getindex()\n\nMaybe.jl also provides low-level functions such as Maybe.getindex which is the \"Maybe\" variant of Base.getindex:\n\njulia> Maybe.getindex(data, findfirst(iseven, data))\nSome(2)\n\njulia> @assert Maybe.getindex(data, findfirst(>=(4), data)) === nothing\n\nSee more in the documentation.\n\n\n\n\n\n","category":"module"},{"location":"#Maybe.X","page":"Maybe.jl","title":"Maybe.X","text":"Maybe.X\n\nA namespace for extra API; this is for preserving Maybe.* namespace for (mainly) Base-compatible API.\n\nSince there is no name clash with Base API, using Maybe.X imports the API defined in Maybe.X.\n\n\n\n\n\n","category":"module"},{"location":"#Maybe.T","page":"Maybe.jl","title":"Maybe.T","text":"Maybe.T{T}\n\nA shorthand for Union{Some{T},Nothing}.\n\n\n\n\n\n","category":"constant"},{"location":"#Maybe.X.getnested","page":"Maybe.jl","title":"Maybe.X.getnested","text":"Maybe.X.getnested(x, k₁, k₂, ..., kₙ) -> v::Union{Some{T},Nothing}\n\nTry to get the item v = x[k₁][k₂][...][kₙ] and return Some(v); return nothing if the key does not exist.\n\n\n\n\n\n","category":"function"},{"location":"#Maybe.X.maybe","page":"Maybe.jl","title":"Maybe.X.maybe","text":"maybe(f) -> f′\n\nTransform (\"lift\") function f(::T₁, ..., ::Tₙ) -> ::Union{Some{R}, R, Nothing} to f′(::Union{Some{T₁}, Nothing}, ..., ::Union{Some{Tₙ}, Nothing}) -> ::Union{Some{R}, Nothing}.\n\nExamples\n\njulia> using Maybe.X\n\njulia> const ⊕ = maybe(+);\n\njulia> 1 ⊕ nothing\n\njulia> 1 ⊕ 2\nSome(3)\n\n\n\n\n\n","category":"function"},{"location":"#Maybe.eltype","page":"Maybe.jl","title":"Maybe.eltype","text":"Maybe.eltype(itr) -> Some(T::Type) or nothing\n\nReturn the element type of iterator if known.\n\nExamples\n\njulia> using Maybe\n\njulia> Maybe.eltype(x + 0 for x in 1:3)\n\njulia> Maybe.eltype(1:0.1:3)\nSome(Float64)\n\n\n\n\n\n","category":"function"},{"location":"#Maybe.get","page":"Maybe.jl","title":"Maybe.get","text":"Maybe.get(d, k) -> Some(x) or nothing\n\nTry to get an item x at key k and return Some(x) if found. Return nothing if not found.\n\nIt is more efficient than calling haskey(dict, key) and then dict[key] because it does not lookup the key twice.\n\nExamples\n\njulia> using Maybe\n\njulia> Maybe.get(Dict(), :a)\n\njulia> Maybe.get(Dict(:a => 1), :a)\nSome(1)\n\n\n\n\n\n","category":"function"},{"location":"#Maybe.getindex","page":"Maybe.jl","title":"Maybe.getindex","text":"Maybge.getindex(xs, indices...) -> Some(x) or nothing\n\nTry to get an item x at location specified by indices and return Some(x) if found.  Return nothing if not found.\n\nWhen xs is an array and Maybge.getindex is called inside @inbounds, it always try to return Some(x) without checking the bounds.\n\nExamples\n\njulia> using Maybe\n\njulia> Maybe.getindex((11, 22, 33), 0)\n\njulia> Maybe.getindex((11, 22, 33), 2)\nSome(22)\n\n\n\n\n\n","category":"function"},{"location":"#Maybe.getproperty","page":"Maybe.jl","title":"Maybe.getproperty","text":"Maybe.getproperty(object, name) -> Some(property) or nothing\n\nReturn the property named name if object has it.\n\nExamples\n\njulia> using Maybe\n\njulia> Maybe.getproperty((a = 1,), :b)\n\njulia> Maybe.getproperty((a = 1,), :a)\nSome(1)\n\n\n\n\n\n","category":"function"},{"location":"#Maybe.length","page":"Maybe.jl","title":"Maybe.length","text":"Maybe.length(itr) -> Some(n::Integer) or nothing\n\nReturn the length of iterator if known.\n\nExamples\n\njulia> using Maybe\n\njulia> Maybe.length(x for x in 1:3 if false)\n\njulia> Maybe.length(1:3)\nSome(3)\n\n\n\n\n\n","category":"function"},{"location":"#Maybe.@?","page":"Maybe.jl","title":"Maybe.@?","text":"@? expr\n\n\"Lift\" functions to operate on Union{Some{T}, Nothing}.\n\nIdea:\n\nEach function f(::T₁, ..., ::Tₙ) -> ::R is (conceptually) lifted to f′(::Union{Some{T₁}, Nothing}, ..., ::Union{Some{Tₙ}, Nothing}) -> ::Union{Some{R}, R, Nothing}.\nIf any of the argument is nothing, @? short-circuits and evaluates to nothing.\n\nSee the tutorial for more information.\n\nExamples\n\njulia> using Maybe\n\njulia> dict = Dict(:a => Dict(:b => 1));\n\njulia> @? dict[:a][:b] + 2\nSome(3)\n\njulia> @? dict[:a][:b] + dict[:c]  # => nothing\n\nThe expression in @? short-circuits when nothing appears in the argument position:\n\njulia> f() = nothing;\n\njulia> @? println(f())\n\nSome is unwrapped when it appears in the argument position:\n\njulia> f() = Some(\"hello\");\n\njulia> @? println(f())\nhello\n\nNon-nothing returned value is always ensured to be wrapped in Some at the end\n\njulia> f() = \"hello\";\n\njulia> @? f()\nSome(\"hello\")\n\njulia> g() = Some(\"hello\");\n\njulia> @? g()\nSome(\"hello\")\n\nnothing literal is always wrapped\n\njulia> @? Some(nothing)\nSome(nothing)\n\nreturn $expr does not return when $expr evaluates to nothing\n\njulia> f() = (@? return identity(nothing); return 1);\n\njulia> f()\n1\n\nreturn $expr returns Some($expr):\n\njulia> @? 1 + 1\nSome(2)\n\njulia> f() = @? return 1 + 1;\n\njulia> f()\nSome(2)\n\n$(...) can be used for switching to the normal evaluation\n\njulia> @? Some(Some(Some(1)))\nSome(1)\n\njulia> @? $(Some(Some(Some(1))))\nSome(Some(Some(Some(1))))\n\n$f(...) can be used for extra wrapping with Some\n\njulia> f() = Some(\"hello\");\n\njulia> @? f()\nSome(\"hello\")\n\njulia> @? $f()\nSome(Some(\"hello\"))\n\n@? recursively transforms functions\n\njulia> @? f(dict, i, j, k) =\n           get(dict, i) do\n               dict[j] + dict[k]\n           end;\n\njulia> f(Dict(), :a, :b, :c)\n\njulia> f(Dict(:a => 1), :a, :b, :c)\nSome(1)\n\njulia> f(Dict(:b => 1), :a, :b, :c)\n\njulia> f(Dict(:b => 1, :c => 2), :a, :b, :c)\nSome(3)\n\n\n\n\n\n","category":"macro"},{"location":"#Maybe.@something","page":"Maybe.jl","title":"Maybe.@something","text":"@something(ex₁, ex₂, ..., exₙ)\n@something{ex₁; ex₂; ...; exₙ}\n@something {ex₁; ex₂; ...; exₙ}\n\nA lazy version of something(x₁, x₂, ..., xₙ).  Evaluate exᵢ one by one and return something(result) of the first non-nothing result of exᵢ.  Throw an error if everything is evaluated to nothing.\n\nnote: Note\n@something{ex₁; ex₂; ...; exₙ} requires Juila >= 1.5.\n\nExamples\n\njulia> using Maybe\n\njulia> @something(\n           (println(\"first\"); nothing),\n           (println(\"second\"); 2),\n           (println(\"third\"); 3),\n       )\nfirst\nsecond\n2\n\njulia> function maybe_add(xs)\n           a = @something(get(xs, 1, nothing), return)\n           b = @something(get(xs, 2, nothing), return)\n           return a + b\n       end;\n\njulia> maybe_add([])\n\njulia> maybe_add([3, 4])\n7\n\njulia> @something(nothing, nothing, nothing)\nERROR: ArgumentError: all evaluated as `nothing`\n[...]\n\nSince @something is often used with @?, the form @something {ex₁; ex₂; ...; exₙ} can also be used to avoid extra parentheses:\n\njulia> d = Dict(:a => Dict(:b => 1, :c => nothing));\n\njulia> @something {\n           @? d[:A][:B];\n           @? d[:A][:b];\n           @? d[:a][:b];\n           @? d[:c][:d];\n       }\n1\n\njulia> @something(\n           (@? d[:A][:B]),\n           (@? d[:A][:b]),\n           (@? d[:a][:b]),\n           (@? d[:c][:d]),\n       )\n1\n\n\n\n\n\n","category":"macro"}]
}
